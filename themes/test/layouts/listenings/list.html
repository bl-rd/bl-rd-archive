{{ define "main" }}

{{ $lazy := resources.Get "js/lazy-load.js" | resources.Minify }}

<div class="single list listenings">

  <header>
    <h1>{{ .Title }}</h1>
    <p>{{ .Description }}</p>
  </header>

  {{ .Content }}

  <ul>
  {{ range first 30 .Pages }}
    <li>
      <article>
        {{ $large := "250x" }}
        {{ $small := "125x" }}
        {{ $original := .Resources.GetMatch "*.jpg" }}
        {{ .Scratch.Set "image_large" ($original.Resize $large) }}
        {{ .Scratch.Set "image_small" ($original.Resize $small) }}
        {{ .Scratch.Set "placeholder" ($original.Resize "1x") }}
        {{ .Scratch.Set "placeholder_large" ((.Scratch.Get "placeholder").Resize $large )}}
        {{ .Scratch.Set "placeholder_small" ((.Scratch.Get "placeholder").Resize $small )}}
        {{ $image_large := .Scratch.Get "image_large" }}
        {{ $image_small := .Scratch.Get "image_small" }}
        {{ $placeholder_large := .Scratch.Get "placeholder_large" }}
        {{ $placeholder_small := .Scratch.Get "placeholder_small" }}
        {{ $alt := print "Album art for " .Title }}
        <picture>
          <source class="lazy" srcset="{{ $placeholder_small.RelPermalink }}" data-src="{{ $image_small.RelPermalink }}" media="(max-width: 66rem)">
          <img class="lazy" src="{{ $placeholder_large.RelPermalink }}" alt="{{ $alt }}" data-src="{{ $image_large.RelPermalink }}"/>
        </picture>
        <div>
          <h2><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
          <small>
            <time timestamp="{{ .PublishDate.Format "2006-01-02T15:04:05Z" }}">{{ .PublishDate.Format "2 January 2006" }}</time>
          </small>
          <div>
            {{ .Content | markdownify }}
            <ul>
              {{ with .Params.artist }}
              <li class="flex-basis:100">Artist: <b>{{ . }}</b></li>
              {{ end}}
              {{ with .Params.bandcampUrl }}
              <li><a rel="noopener nofollow" href="{{.}}">BandCamp</a></li>
              {{ end }}
              {{ with .Params.spotifyUrl }}
              <li><a rel="noopener nofollow" href="{{.}}">Spotify</a></li>
              {{ end }}
            </ul>
          </div>
        </div>
      </article>
    </li>
  {{ end }}
  </ul>
</div>

<script defer type="module">
  import { lazyLoad } from '{{ $lazy.Permalink }}';
  lazyLoad('.lazy');
</script>
{{ end }}